<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç iOS 26.1 Web Speech API</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 20px; }
        .test-result { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 10px; 
            border-left: 5px solid #ccc;
        }
        .success { border-color: #4CAF50; background: #e8f5e9; }
        .error { border-color: #f44336; background: #ffebee; }
        .warning { border-color: #ff9800; background: #fff3e0; }
        .info { border-color: #2196F3; background: #e3f2fd; }
        button { 
            padding: 12px 24px; 
            margin: 10px 5px; 
            font-size: 16px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer;
        }
        .primary-btn { background: #2196F3; color: white; }
        .secondary-btn { background: #f5f5f5; color: #333; }
        .danger-btn { background: #f44336; color: white; }
        code { background: #f5f5f5; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç Web Speech API –¥–ª—è iOS 26.1</h1>
    
    <div id="results">
        <div class="test-result info" id="initialStatus">
            <p>–ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...</p>
        </div>
    </div>
    
    <div style="margin: 20px 0;">
        <button class="primary-btn" onclick="runFullDiagnostics()">üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
        <button class="secondary-btn" onclick="testMicrophone()">üé§ –¢–µ—Å—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</button>
        <button class="secondary-btn" onclick="testSpeechRecognition()">üéôÔ∏è –¢–µ—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏</button>
        <button class="danger-btn" onclick="resetSafariSettings()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Safari</button>
    </div>
    
    <div id="detailedInfo" style="display: none; margin-top: 30px;">
        <h3>üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
        <pre id="debugOutput"></pre>
    </div>
    
    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<p>${message}</p>`;
            document.getElementById('results').appendChild(div);
            console.log(`${type.toUpperCase()}: ${message}`);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        function getIOSVersion() {
            const ua = navigator.userAgent;
            const match = ua.match(/OS (\d+)_(\d+)_?(\d+)?/);
            return match ? `${match[1]}.${match[2]}.${match[3] || '0'}` : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞';
        }
        
        function runFullDiagnostics() {
            clearResults();
            
            const iosVersion = getIOSVersion();
            addResult(`üì± iOS –≤–µ—Ä—Å–∏—è: <strong>${iosVersion}</strong>`, 'info');
            
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent);
            
            addResult(`üçé iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: <strong>${isIOS ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</strong>`, isIOS ? 'success' : 'error');
            addResult(`üåê –ë—Ä–∞—É–∑–µ—Ä Safari: <strong>${isSafari ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</strong>`, isSafari ? 'success' : 'error');
            addResult(`üîµ –ë—Ä–∞—É–∑–µ—Ä Chrome: <strong>${isChrome ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</strong>`, 'info');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Web Speech API
            addResult('<hr><strong>üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ Web Speech API:</strong>', 'info');
            
            const hasWebkitSpeechRecognition = 'webkitSpeechRecognition' in window;
            const hasSpeechRecognition = 'SpeechRecognition' in window;
            
            addResult(`<code>webkitSpeechRecognition</code> –≤ window: <strong>${hasWebkitSpeechRecognition ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}</strong>`, 
                     hasWebkitSpeechRecognition ? 'success' : 'error');
            
            addResult(`<code>SpeechRecognition</code> –≤ window: <strong>${hasSpeechRecognition ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}</strong>`, 
                     hasSpeechRecognition ? 'success' : 'warning');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ window.webkit
            const hasWebkitObject = typeof window.webkit !== 'undefined';
            const hasWebkitSpeech = hasWebkitObject && typeof window.webkit.speechRecognition !== 'undefined';
            
            addResult(`–û–±—ä–µ–∫—Ç <code>window.webkit</code>: <strong>${hasWebkitObject ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}</strong>`, 
                     hasWebkitObject ? 'success' : 'warning');
            
            addResult(`<code>window.webkit.speechRecognition</code>: <strong>${hasWebkitSpeech ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}</strong>`, 
                     hasWebkitSpeech ? 'success' : 'warning');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
            addResult('<hr><strong>üé§ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:</strong>', 'info');
            
            const hasMediaDevices = !!navigator.mediaDevices;
            const hasGetUserMedia = hasMediaDevices && !!navigator.mediaDevices.getUserMedia;
            
            addResult(`<code>navigator.mediaDevices</code>: <strong>${hasMediaDevices ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}</strong>`, 
                     hasMediaDevices ? 'success' : 'error');
            
            addResult(`<code>getUserMedia</code>: <strong>${hasGetUserMedia ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}</strong>`, 
                     hasGetUserMedia ? 'success' : 'error');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
            const isHTTPS = window.location.protocol === 'https:';
            addResult(`üîê HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: <strong>${isHTTPS ? '‚úÖ –î–∞' : '‚ö†Ô∏è –ù–µ—Ç (HTTP)'}</strong>`, 
                     isHTTPS ? 'success' : 'warning');
            
            // –ò—Ç–æ–≥
            addResult('<hr><strong>üìä –ò–¢–û–ì:</strong>', 'info');
            
            const webSpeechAvailable = hasWebkitSpeechRecognition || hasSpeechRecognition || hasWebkitSpeech;
            
            if (webSpeechAvailable) {
                addResult('‚úÖ Web Speech API –î–û–°–¢–£–ü–ï–ù –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ', 'success');
                addResult('–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                addResult('–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –∫–æ–¥–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', 'warning');
            } else {
                addResult('‚ùå Web Speech API –ù–ï –î–û–°–¢–£–ü–ï–ù –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ', 'error');
                
                if (isIOS && isSafari) {
                    addResult('<strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –¥–ª—è iOS 26.1 + Safari:</strong>', 'error');
                    addResult('1. üö´ Web Speech API –æ—Ç–∫–ª—é—á–µ–Ω –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Safari', 'error');
                    addResult('2. üõ°Ô∏è –ë–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è Safari', 'error');
                    addResult('3. üîß –û—à–∏–±–∫–∞ –≤ iOS 26.1 (–±–∞–≥ –≤–µ—Ä—Å–∏–∏)', 'error');
                    addResult('4. üìµ –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º Safari', 'error');
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById('detailedInfo').style.display = 'block';
            document.getElementById('debugOutput').textContent = JSON.stringify({
                userAgent: navigator.userAgent,
                iosVersion: iosVersion,
                isIOS: isIOS,
                isSafari: isSafari,
                webkitSpeechRecognition: hasWebkitSpeechRecognition,
                speechRecognition: hasSpeechRecognition,
                windowWebkit: hasWebkitObject,
                windowWebkitSpeech: hasWebkitSpeech,
                mediaDevices: hasMediaDevices,
                getUserMedia: hasGetUserMedia,
                https: isHTTPS,
                url: window.location.href,
                timestamp: new Date().toISOString()
            }, null, 2);
        }
        
        async function testMicrophone() {
            addResult('üîç –¢–µ—Å—Ç–∏—Ä—É—é –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É...', 'info');
            
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                addResult('‚ùå API –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
                return;
            }
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }
                });
                
                addResult('‚úÖ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω!', 'success');
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ—Ç–æ–∫
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                
                addResult('üîä –ê—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—ë
                stream.getTracks().forEach(track => track.stop());
                audioContext.close();
                
                addResult('‚úÖ –¢–µ—Å—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: ${error.message}`, 'error');
                
                if (error.name === 'NotAllowedError') {
                    addResult('üëÜ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª –≤ –¥–æ—Å—Ç—É–ø–µ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É', 'warning');
                    addResult('–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –¥–∏–∞–ª–æ–≥–µ Safari –∏–ª–∏ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Safari ‚Üí –ú–∏–∫—Ä–æ—Ñ–æ–Ω', 'warning');
                } else if (error.name === 'NotFoundError') {
                    addResult('üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ', 'error');
                } else if (error.name === 'NotSupportedError') {
                    addResult('üåê –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ –∑–∞—Ö–≤–∞—Ç', 'error');
                }
            }
        }
        
        function testSpeechRecognition() {
            addResult('üîç –¢–µ—Å—Ç–∏—Ä—É—é —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏...', 'info');
            
            // –ü—Ä–æ–±—É–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è API
            let SpeechRecognition = null;
            
            if (typeof window.webkitSpeechRecognition !== 'undefined') {
                SpeechRecognition = window.webkitSpeechRecognition;
                addResult('‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é window.webkitSpeechRecognition', 'success');
            } else if (typeof window.SpeechRecognition !== 'undefined') {
                SpeechRecognition = window.SpeechRecognition;
                addResult('‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é window.SpeechRecognition', 'success');
            } else if (typeof window.webkit !== 'undefined' && typeof window.webkit.speechRecognition !== 'undefined') {
                SpeechRecognition = window.webkit.speechRecognition;
                addResult('‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é window.webkit.speechRecognition', 'success');
            } else {
                addResult('‚ùå SpeechRecognition API –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            try {
                const recognition = new SpeechRecognition();
                addResult('‚úÖ –û–±—ä–µ–∫—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω', 'success');
                
                recognition.lang = 'ru-RU';
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                
                recognition.onstart = function() {
                    addResult('‚ñ∂Ô∏è –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –Ω–∞—á–∞—Ç–æ', 'success');
                };
                
                recognition.onerror = function(event) {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: ${event.error}`, 'error');
                };
                
                recognition.onend = function() {
                    addResult('‚èπÔ∏è –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    const confidence = event.results[0][0].confidence;
                    addResult(`üìù –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "${transcript}" (—Ç–æ—á–Ω–æ—Å—Ç—å: ${confidence.toFixed(2)})`, 'success');
                };
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã
                recognition.start();
                addResult('üéôÔ∏è –ì–æ–≤–æ—Ä–∏—Ç–µ —Å–µ–π—á–∞—Å...', 'info');
                
                setTimeout(() => {
                    try {
                        recognition.stop();
                        addResult('‚úÖ –¢–µ—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
                    } catch (e) {
                        addResult('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ', 'warning');
                    }
                }, 3000);
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—è: ${error.message}`, 'error');
                addResult(`–¢–∏–ø –æ—à–∏–±–∫–∏: ${error.name}`, 'error');
            }
        }
        
        function resetSafariSettings() {
            addResult('üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–±—Ä–æ—Å—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ Safari:', 'warning');
            addResult('1. üì± –û—Ç–∫—Ä–æ–π—Ç–µ <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Safari</strong>', 'info');
            addResult('2. üîß –ù–∞–∂–º–∏—Ç–µ <strong>"–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è"</strong>', 'info');
            addResult('3. üé§ –í —Ä–∞–∑–¥–µ–ª–µ <strong>"–ú–∏–∫—Ä–æ—Ñ–æ–Ω"</strong> –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à —Å–∞–π—Ç –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–°–ø—Ä–∞—à–∏–≤–∞—Ç—å"', 'info');
            addResult('4. üßπ –ù–∞–∂–º–∏—Ç–µ <strong>"–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏ –¥–∞–Ω–Ω—ã–µ –≤–µ–±-—Å–∞–π—Ç–æ–≤"</strong>', 'info');
            addResult('5. üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'info');
            addResult('6. üîå –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ iPhone', 'info');
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            setTimeout(runFullDiagnostics, 500);
        });
    </script>
</body>
</html>